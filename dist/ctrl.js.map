{"version":3,"sources":["../src/ctrl.js"],"names":["config","MetricsPanelCtrl","_","kbn","d3","panelDefaults","legend","show","position","chartType","labelOrientation","orientation","avgLineShow","labelSpace","links","datasource","interval","targets","cacheTimeout","nullPointMode","aliasColors","format","valueName","sortType","sortDirection","strokeWidth","fontSize","colorSet","colorSch","getCurrentTheme","theme","GroupedBarChartCtrl","$scope","$injector","$rootScope","data","defaults","panel","events","on","onInitEditMode","bind","onDataReceived","onDataError","addEditorTab","subItem","value","render","forEach","push","d","color","dataList","length","o","groupBy","rows","e","forOwn","i","t","sta","sum","tid","map","s","reduce","x","y","res","label","sort","a","b","aSum","Object","values","prevVal","curVal","bSum","reverse","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","decimals","scaledDecimals","scope","elem","attrs","ctrl","panelContent","find","groupedBarChart","opts","margin","panelEl","showLegend","legendType","grafanaTheme","axesConfig","element","options","concat","keys","uniq","filter","key","avgList","stackVal","valores","k","name","scale","ordinal","range","category20","draw","width","height","graphwidth","left","right","graphheight","top","bottom","select","html","svg","append","attr","createScales","addAxes","addTooltips","addBar","addLegend","y0","rangeRoundBands","y1","linear","x0","x1","xAxis","axis","tickSize","orient","yAxis","domain","rangeBand","chartScale","domainCal","max","xAxisConfig","call","selectAll","style","colors","text","yAxisConfig","bar","enter","barC","tips","elements","elementData","__data__","display","loc","defaultOptions","slice","background","scrollbar","textEmphasis","onRender","Chart","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQA,kB,mBAAAA,M;;AACAC,4B,kBAAAA,gB;;AACDC,a;;AACAC,e;;AAEKC,c;;;;;;;;;;;;;;;;;;;;;AAENC,yB,GAAgB;AAClBC,wBAAQ;AACJC,0BAAM,IADF;AAEJC,8BAAU;AAFN,iBADU;AAKlBC,2BAAW,mBALO;AAMlBC,kCAAkB,YANA;AAOlBC,6BAAa,UAPK;AAQlBC,6BAAa,IARK;AASlBC,4BAAY,EATM;AAUlBC,uBAAO,EAVW;AAWlBC,4BAAY,IAXM;AAYlBC,0BAAU,IAZQ;AAalBC,yBAAS,CAAC,EAAD,CAbS;AAclBC,8BAAc,IAdI;AAelBC,+BAAe,WAfG;AAgBlBC,6BAAa,EAhBK;AAiBlBC,wBAAQ,OAjBU;AAkBlBC,2BAAW,SAlBO;AAmBlBC,0BAAU,aAnBQ;AAoBlBC,+BAAe,WApBG;AAqBlBC,6BAAa,CArBK;AAsBlBC,0BAAU,KAtBQ;AAuBlBC,0BAAU,EAvBQ;AAwBlBC,0BAAU;AAxBQ,a;;AA2BhBC,2B,GAAkB,SAAlBA,eAAkB;AAAA,uBAAM7B,OAAO8B,KAAb;AAAA,a;;2CAEXC,mB;;;AAET,6CAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,UAA/B,EAA2C;AAAA;;AAAA,0JACjCF,MADiC,EACzBC,SADyB;;AAEvC,0BAAKE,IAAL,GAAY,IAAZ;;AAEAjC,sBAAEkC,QAAF,CAAW,MAAKC,KAAhB,EAAuBhC,aAAvB;;AAEA,0BAAKiC,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,OAAjC;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKG,cAAL,CAAoBD,IAApB,OAAhC;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,MAAKG,cAAL,CAAoBD,IAApB,OAArC;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKI,WAAL,CAAiBF,IAAjB,OAA7B;AATuC;AAU1C;;;;qDAEgB;AACb,6BAAKG,YAAL,CAAkB,SAAlB,EAA6B,mEAA7B,EAAkG,CAAlG;AACA,6BAAKA,YAAL,CAAkB,QAAlB,EAA4B,mEAA5B,EAAiG,CAAjG;AACH;;;kDAEaC,O,EAAS;AACnB,6BAAKR,KAAL,CAAWhB,MAAX,GAAoBwB,QAAQC,KAA5B;AACA,6BAAKC,MAAL;AACH;;;kDAEa;AACV,6BAAKA,MAAL;AACH;;;qDAEgB;AAAA;;AACb,6BAAKV,KAAL,CAAWT,QAAX,GAAsB,EAAtB;AACA,6BAAKS,KAAL,CAAWV,QAAX,CAAoBqB,OAApB,CAA4B;AAAA,mCAAK,OAAKX,KAAL,CAAWT,QAAX,CAAoBqB,IAApB,CAAyBC,EAAEC,KAA3B,CAAL;AAAA,yBAA5B;AACA,6BAAKJ,MAAL;AACH;;;mDAEcK,Q,EAAU;AACrB,4BAAIA,YAAYA,SAASC,MAAzB,EAAiC;AAC7B,gCAAIC,IAAIpD,EAAEqD,OAAF,CAAUH,SAAS,CAAT,EAAYI,IAAtB,EAA4B;AAAA,uCAAKC,EAAE,CAAF,CAAL;AAAA,6BAA5B,CAAR;AACAvD,8BAAEwD,MAAF,CAASJ,CAAT,EAAY,UAACG,CAAD,EAAIE,CAAJ,EAAU;AAClB,oCAAIC,IAAI1D,EAAEqD,OAAF,CAAUE,CAAV,EAAa;AAAA,2CAAOI,IAAI,CAAJ,CAAP;AAAA,iCAAb,CAAR;AACAP,kCAAEK,CAAF,IAAOzD,EAAEwD,MAAF,CAASE,CAAT,EAAY,UAACE,GAAD,EAAMC,GAAN,EAAc;AAACH,sCAAEG,GAAF,IAASD,IAAIE,GAAJ,CAAQ;AAAA,+CAAKC,EAAE,CAAF,CAAL;AAAA,qCAAR,EAAmBC,MAAnB,CAA0B,UAACC,CAAD,EAAGC,CAAH;AAAA,+CAASD,IAAEC,CAAX;AAAA,qCAA1B,CAAT;AAAiD,iCAA5E,CAAP;AACH,6BAHD;;AAKA,gCAAIC,MAAM,EAAV;AACAnE,8BAAEwD,MAAF,CAASJ,CAAT,EAAY,UAACG,CAAD,EAAIE,CAAJ,EAAU;AAClBF,kCAAEa,KAAF,GAAUX,CAAV;AACAU,oCAAIpB,IAAJ,CAASQ,CAAT;AACH,6BAHD;AAIA,gCAAI,KAAKpB,KAAL,CAAWd,QAAX,KAAwB,aAA5B,EAA2C;AACvC,qCAAKY,IAAL,GAAYkC,IAAIE,IAAJ,CAAS,UAACC,CAAD,EAAIC,CAAJ,EAAU;AAC3B,2CAAQD,EAAEF,KAAF,GAAUG,EAAEH,KAAb,GAAsB,CAAC,CAAvB,GAA6BG,EAAEH,KAAF,GAAUE,EAAEF,KAAb,GAAsB,CAAtB,GAA0B,CAA7D;AACH,iCAFW,CAAZ;AAGH,6BAJD,MAIO;AACH,qCAAKnC,IAAL,GAAYkC,IAAIE,IAAJ,CAAS,UAACC,CAAD,EAAIC,CAAJ,EAAU;AAC3B,wCAAIC,OAAOC,OAAOC,MAAP,CAAcJ,CAAd,EAAiBN,MAAjB,CAAwB,UAACW,OAAD,EAAUC,MAAV,EAAqB;AACpD,+CAAO,OAAOA,MAAP,IAAiB,QAAjB,GAA4BD,UAAUC,MAAtC,GAA+CD,OAAtD;AACH,qCAFU,CAAX;AAGA,wCAAIE,OAAOJ,OAAOC,MAAP,CAAcH,CAAd,EAAiBP,MAAjB,CAAwB,UAACW,OAAD,EAAUC,MAAV,EAAqB;AACpD,+CAAO,OAAOA,MAAP,IAAiB,QAAjB,GAA4BD,UAAUC,MAAtC,GAA+CD,OAAtD;AACH,qCAFU,CAAX;;AAIA,2CAAQH,OAAOK,IAAR,GAAgB,CAAC,CAAjB,GAAuBA,OAAOL,IAAR,GAAgB,CAAhB,GAAoB,CAAjD;AACH,iCATW,CAAZ;AAUH;AACD,gCAAI,KAAKrC,KAAL,CAAWb,aAAX,KAA6B,WAAjC,EAA8C;AAC1C,qCAAKW,IAAL,CAAU6C,OAAV;AACH;AACJ,yBA/BD,MA+BO;AACH,iCAAK7C,IAAL,GAAY,CACR,EAACmC,OAAM,YAAP,EAAqB,OAAM,EAA3B,EAA+B,QAAO,EAAtC,EAA0C,OAAO,CAAjD,EAAoD,QAAO,EAA3D,EADQ,EAER,EAACA,OAAM,YAAP,EAAqB,OAAM,EAA3B,EAA+B,QAAO,CAAtC,EAAyC,OAAM,EAA/C,EAAmD,QAAO,EAA1D,EAFQ,EAGR,EAACA,OAAM,YAAP,EAAqB,OAAM,EAA3B,EAA+B,QAAO,EAAtC,EAA0C,OAAM,EAAhD,EAAoD,QAAO,EAA3D,EAHQ,EAIR,EAACA,OAAM,YAAP,EAAqB,OAAM,EAA3B,EAA+B,QAAO,EAAtC,EAA0C,OAAM,EAAhD,EAAoD,QAAO,EAA3D,EAJQ,CAAZ;AAMH;;AAED,6BAAKvB,MAAL;AACH;;;gDAEWD,K,EAAO;AACf,4BAAImC,cAAc,KAAKC,mBAAL,CAAyBpC,KAAzB,CAAlB;AACA,4BAAIqC,aAAahF,IAAIiF,YAAJ,CAAiB,KAAK/C,KAAL,CAAWhB,MAA5B,CAAjB;AACA,4BAAI8D,UAAJ,EAAgB;AACZ,mCAAOA,WAAWrC,KAAX,EAAkBmC,YAAYI,QAA9B,EAAwCJ,YAAYK,cAApD,CAAP;AACH;AACD,+BAAOxC,KAAP;AACH;;;yCAEIyC,K,EAAOC,I,EAAMC,K,EAAOC,I,EAAM;AAC3B,6BAAKC,YAAL,GAAoBH,KAAKI,IAAL,CAAU,gBAAV,CAApB;;AAD2B,4BAGrBC,eAHqB;AAIvB,qDAAYC,IAAZ,EAAkB;AAAA;;AAAA;;AACd,qCAAK3D,IAAL,GAAY2D,KAAK3D,IAAjB;AACA,qCAAK4D,MAAL,GAAcD,KAAKC,MAAnB;AACA,qCAAKC,OAAL,GAAeF,KAAKE,OAApB;AACA,qCAAKC,UAAL,GAAkBH,KAAKxF,MAAvB;AACA,qCAAK4F,UAAL,GAAkBJ,KAAKtF,QAAvB;AACA,qCAAKC,SAAL,GAAiBqF,KAAKrF,SAAtB;AACA,qCAAKE,WAAL,GAAmBmF,KAAKnF,WAAxB;AACA,qCAAKE,UAAL,GAAkBiF,KAAKjF,UAAvB;AACA,qCAAKsF,YAAL,GAAoBtE,iBAApB;AACA,qCAAKnB,gBAAL,GAAwBoF,KAAKpF,gBAA7B;AACA,qCAAKE,WAAL,GAAmBkF,KAAKlF,WAAxB;AACA,qCAAKwF,UAAL,GAAkB,EAAlB;AACA,qCAAKC,OAAL,GAAeb,KAAKI,IAAL,CAAUE,KAAKO,OAAf,EAAwB,CAAxB,CAAf;AACA,qCAAKC,OAAL,GAAe,EAAf;AACA,qCAAKnE,IAAL,CAAUa,OAAV,CAAkB,aAAK;AACnB,2CAAKsD,OAAL,GAAe,OAAKA,OAAL,CAAaC,MAAb,CAAoBnG,GAAGoG,IAAH,CAAQtD,CAAR,CAApB,CAAf;AACH,iCAFD;AAGA,qCAAKoD,OAAL,GAAepG,EAAEuG,IAAF,CAAO,KAAKH,OAAL,CAAaI,MAAb,CAAoB;AAAA,2CAAOC,QAAQ,OAAf;AAAA,iCAApB,CAAP,CAAf;AACA,qCAAKC,OAAL,GAAe,EAAf;AACA,qCAAKN,OAAL,CAAatD,OAAb,CAAqB,aAAK;AAAC,2CAAK4D,OAAL,CAAa1D,CAAb,IAAkB,CAAlB;AAAoB,iCAA/C;AACA,qCAAKoD,OAAL,GAAe,KAAKA,OAAL,CAAaI,MAAb,CAAoB;AAAA,2CAAKxD,MAAI,SAAT;AAAA,iCAApB,CAAf;AACA,qCAAKf,IAAL,CAAUa,OAAV,CAAkB,aAAK;AACnB,wCAAI6D,WAAW,CAAf;AACA3D,sCAAE4D,OAAF,GAAY,OAAKR,OAAL,CAAaI,MAAb,CAAoB;AAAA,+CAAKK,KAAK7D,CAAV;AAAA,qCAApB,EAAiCc,GAAjC,CAAqC,UAACgD,IAAD,EAAOrD,CAAP,EAAUL,CAAV,EAAgB;AAC7D,4CAAIK,MAAM,CAAV,EAAakD,WAAWA,WAAY,CAAC3D,EAAEI,EAAEK,IAAE,CAAJ,CAAF,CAAxB;AACb,+CAAKiD,OAAL,CAAaI,IAAb,IAAqB,OAAKJ,OAAL,CAAaI,IAAb,IAAqB9D,EAAE8D,IAAF,CAA1C;AACA,+CAAO,EAACA,MAAMA,IAAP,EAAalE,OAAO,CAACI,EAAE8D,IAAF,CAArB,EAA8BH,UAAUA,QAAxC,EAAP;AACH,qCAJW,CAAZ;AAKH,iCAPD;AAQA,qCAAKP,OAAL,CAAatD,OAAb,CAAqB,aAAK;AACtB,2CAAK4D,OAAL,CAAa1D,CAAb,KAAmB,OAAKf,IAAL,CAAUkB,MAA7B;AACH,iCAFD;AAGA,oCAAIyC,KAAK3C,KAAL,CAAWE,MAAX,IAAqB,CAAzB,EAA4B;AACxB,yCAAKF,KAAL,GAAa/C,GAAG6G,KAAH,CAASC,OAAT,GACRC,KADQ,CACF/G,GAAG6G,KAAH,CAASG,UAAT,GAAsBD,KAAtB,EADE,CAAb;AAEH,iCAHD,MAGO;AACH,yCAAKhE,KAAL,GAAa/C,GAAG6G,KAAH,CAASC,OAAT,GACRC,KADQ,CACFrB,KAAK3C,KADH,CAAb;AAEH;;AAED,qCAAKkE,IAAL;AACH;;AA9CsB;AAAA;AAAA,uDAgDhB;AACH,wCAAMC,QAAQ,KAAKtB,OAAL,CAAasB,KAAb,EAAd;AACA,wCAAMC,SAAS,KAAKvB,OAAL,CAAauB,MAAb,EAAf;AACA,yCAAKC,UAAL,GAAkBF,QAAQ,KAAKvB,MAAL,CAAY0B,IAApB,GAA2B,KAAK1B,MAAL,CAAY2B,KAAzD;AACA,yCAAKC,WAAL,GAAmBJ,SAAO,GAAP,GAAa,KAAKxB,MAAL,CAAY6B,GAAzB,GAA+B,KAAK7B,MAAL,CAAY8B,MAA9D;AACAzH,uCAAG0H,MAAH,CAAU,KAAKzB,OAAf,EAAwB0B,IAAxB,CAA6B,EAA7B;AACA,yCAAKC,GAAL,GAAW5H,GAAG0H,MAAH,CAAU,KAAKzB,OAAf,EAAwB4B,MAAxB,CAA+B,KAA/B,CAAX;AACA,yCAAKD,GAAL,CAASE,IAAT,CAAc,OAAd,EAAuBZ,KAAvB,EACKY,IADL,CACU,QADV,EACoBX,MADpB,EAEKW,IAFL,CAEU,WAFV,oBAEuC,KAAKnC,MAAL,CAAY6B,GAFnD;;AAIA,yCAAKO,YAAL;AACA,yCAAKC,OAAL;AACA,yCAAKC,WAAL;AACA,yCAAKC,MAAL;AACA,wCAAI,KAAKrC,UAAT,EAAqB,KAAKsC,SAAL,CAAe,KAAKrC,UAApB;AACxB;AAhEsB;AAAA;AAAA,+DAkER;AACX,4CAAO,KAAKvF,WAAZ;AACI,6CAAK,YAAL;AACI,iDAAK6H,EAAL,GAAUpI,GAAG6G,KAAH,CAASC,OAAT,GACLuB,eADK,CACW,CAAC,CAAC,KAAKd,WAAP,EAAoB,CAApB,CADX,EACmC,EADnC,EACuC,GADvC,CAAV;;AAGA,iDAAKe,EAAL,GAAUtI,GAAG6G,KAAH,CAASC,OAAT,EAAV;;AAEA,iDAAK/C,CAAL,GAAS/D,GAAG6G,KAAH,CAAS0B,MAAT,GACJxB,KADI,CACE,CAAC,CAAD,EAAI,CAAC,KAAKK,UAAV,CADF,CAAT;AAEA,iDAAKpB,UAAL,GAAkB,CAAC,KAAKjC,CAAN,EAAS,KAAKqE,EAAd,EAAkB,KAAKA,EAAvB,EAA2B,KAAKE,EAAhC,EAAoC,KAAKvE,CAAzC,CAAlB;AACA;AACJ,6CAAK,UAAL;AACI,iDAAKyE,EAAL,GAAUxI,GAAG6G,KAAH,CAASC,OAAT,GACLuB,eADK,CACW,CAAC,CAAD,EAAI,CAAC,KAAKjB,UAAV,CADX,EACkC,EADlC,EACsC,GADtC,CAAV;;AAGA,iDAAKqB,EAAL,GAAUzI,GAAG6G,KAAH,CAASC,OAAT,EAAV;;AAEA,iDAAK9C,CAAL,GAAShE,GAAG6G,KAAH,CAAS0B,MAAT,GACJxB,KADI,CACE,CAAC,CAAD,EAAI,CAAC,KAAKQ,WAAV,CADF,CAAT;;AAGA,iDAAKvB,UAAL,GAAkB,CAAC,KAAKwC,EAAN,EAAU,KAAKxE,CAAf,EAAkB,KAAKwE,EAAvB,EAA2B,KAAKC,EAAhC,EAAoC,KAAKzE,CAAzC,CAAlB;AACA;AArBR;AAwBH;AA3FsB;AAAA;AAAA,0DA6Fb;AACN,yCAAK0E,KAAL,GAAa1I,GAAG4H,GAAH,CAAOe,IAAP,GACR9B,KADQ,CACF,KAAKb,UAAL,CAAgB,CAAhB,CADE,EAER4C,QAFQ,CAEC,CAAC,KAAKrB,WAFP,EAGRsB,MAHQ,CAGD,QAHC,CAAb;;AAKA,yCAAKC,KAAL,GAAa9I,GAAG4H,GAAH,CAAOe,IAAP,GACR9B,KADQ,CACF,KAAKb,UAAL,CAAgB,CAAhB,CADE,EAER6C,MAFQ,CAED,MAFC,CAAb;;AAIA,yCAAK7C,UAAL,CAAgB,CAAhB,EAAmB+C,MAAnB,CAA0B,KAAKhH,IAAL,CAAU6B,GAAV,CAAc,aAAK;AAAE,+CAAOd,EAAEoB,KAAT;AAAiB,qCAAtC,CAA1B;AACA,yCAAK8B,UAAL,CAAgB,CAAhB,EAAmB+C,MAAnB,CAA0B,KAAK7C,OAA/B,EAAwCmC,eAAxC,CAAwD,CAAC,CAAD,EAAI,KAAKrC,UAAL,CAAgB,CAAhB,EAAmBgD,SAAnB,EAAJ,CAAxD;;AAEA,wCAAIC,aAAc,KAAK5I,SAAL,KAAmB,WAApB,GAAmC,CAAnC,GAAuC,CAAxD;AACA,wCAAI6I,YAAa,KAAK3I,WAAL,KAAqB,YAAtB,GACV,CAAC,CAAD,EAAIP,GAAGmJ,GAAH,CAAO,KAAKpH,IAAZ,EAAkB,UAASe,CAAT,EAAY;AAAE,+CAAO9C,GAAGmJ,GAAH,CAAOrG,EAAE4D,OAAT,EAAkB,aAAK;AAAE,mDAAQ5D,EAAEJ,KAAF,GAAUuG,aAAWnG,EAAE2D,QAA/B;AAA2C,yCAApE,CAAP;AAA+E,qCAA/G,CAAJ,CADU,GAEV,CAACzG,GAAGmJ,GAAH,CAAO,KAAKpH,IAAZ,EAAkB,UAASe,CAAT,EAAY;AAAE,+CAAO9C,GAAGmJ,GAAH,CAAOrG,EAAE4D,OAAT,EAAkB,aAAK;AAAE,mDAAQ5D,EAAEJ,KAAF,GAAUuG,aAAWnG,EAAE2D,QAA/B;AAA2C,yCAApE,CAAP;AAA+E,qCAA/G,CAAD,EAAmH,CAAnH,CAFN;AAGA,yCAAKT,UAAL,CAAgB,CAAhB,EAAmB+C,MAAnB,CAA0BG,SAA1B;;AAEA,wCAAIE,cAAc,KAAKxB,GAAL,CAASC,MAAT,CAAgB,GAAhB,EACbC,IADa,CACR,OADQ,EACC,QADD,EAEbA,IAFa,CAER,WAFQ,iBAEkB,KAAKnC,MAAL,CAAY0B,IAF9B,WAEuC,KAAKE,WAAL,GAAmB,KAAK5B,MAAL,CAAY6B,GAFtE,SAGb6B,IAHa,CAGR,KAAKX,KAHG,EAIbY,SAJa,CAIH,MAJG,EAKbC,KALa,CAKP,MALO,OAKI,KAAKxD,YAAL,CAAkByD,MAAlB,CAAyBC,IAL7B,CAAlB;;AAOAL,gDAAYE,SAAZ,CAAsB,YAAtB,EACKC,KADL,CACW,QADX,OACwB,KAAKxD,YAAL,CAAkByD,MAAlB,CAAyBC,IADjD;;AAGA,4CAAO,KAAKnJ,gBAAZ;AACI,6CAAK,YAAL;AACI;AACJ,6CAAK,YAAL;AACI8I,wDAAYG,KAAZ,CAAkB,aAAlB,EAAiC,KAAjC,EACKA,KADL,CACW,WADX,EACwB,gBADxB;AAEA;AACJ,6CAAK,UAAL;AACIH,wDAAYG,KAAZ,CAAkB,aAAlB,EAAiC,KAAjC,EACKA,KADL,CACW,WADX,EACwB,gBADxB;AAEA;AAVR;;AAaA,wCAAIG,cAAc,KAAK9B,GAAL,CAASC,MAAT,CAAgB,GAAhB,EACbC,IADa,CACR,OADQ,EACC,QADD,EAEbA,IAFa,CAER,WAFQ,iBAEkB,KAAKnC,MAAL,CAAY0B,IAF9B,UAEuC,KAAK1B,MAAL,CAAY6B,GAFnD,QAGb+B,KAHa,CAGP,MAHO,EAGC,MAHD,EAIbF,IAJa,CAIR,KAAKP,KAJG,CAAlB;;AAMAY,gDAAYJ,SAAZ,CAAsB,MAAtB,EACKC,KADL,CACW,MADX,OACsB,KAAKxD,YAAL,CAAkByD,MAAlB,CAAyBC,IAD/C;AAEAC,gDAAYJ,SAAZ,CAAsB,MAAtB,EACKC,KADL,CACW,QADX,OACwB,KAAKxD,YAAL,CAAkByD,MAAlB,CAAyBC,IADjD;AAEAC,gDAAYJ,SAAZ,CAAsB,YAAtB,EACKC,KADL,CACW,QADX,OACwB,KAAKxD,YAAL,CAAkByD,MAAlB,CAAyBC,IADjD;AAGH;AApJsB;AAAA;AAAA,yDAsJd;AAAA;;AACL,wCAAI5C,QAAS,KAAKxG,SAAL,KAAmB,WAApB,GAAmC,CAAnC,GAAuC,KAAK6F,OAAL,CAAajD,MAAhE;AACA,4CAAO,KAAK1C,WAAZ;AACI,6CAAK,YAAL;AACI,iDAAKC,WAAL,IAAoB,KAAK0F,OAAL,CAAatD,OAAb,CAAqB,aAAK;AAC1C,uDAAKgF,GAAL,CAASC,MAAT,CAAgB,MAAhB,EACKC,IADL,CACU,IADV,EACgB,OAAK/D,CAAL,CAAO,OAAKyC,OAAL,CAAa1D,CAAb,CAAP,CADhB,EAEKgF,IAFL,CAEU,IAFV,EAEgB,OAAKP,WAFrB,EAGKO,IAHL,CAGU,IAHV,EAGgB,OAAK/D,CAAL,CAAO,OAAKyC,OAAL,CAAa1D,CAAb,CAAP,CAHhB,EAIKgF,IAJL,CAIU,IAJV,EAIgB,CAJhB,EAKKA,IALL,CAKU,OALV,EAKsBhF,CALtB,eAMKgF,IANL,CAMU,WANV,iBAMoC,OAAKnC,MAAL,CAAY0B,IANhD,UAMyD,OAAK1B,MAAL,CAAY6B,GANrE,QAOK+B,KAPL,CAOW,SAPX,EAOsB,MAPtB,EAQKA,KARL,CAQW,cARX,EAQ2B,CAR3B,EASKA,KATL,CASW,QATX,EASqB,OAAKxG,KAAL,CAAWD,CAAX,CATrB,EAUKyG,KAVL,CAUW,gBAVX,EAU6B,GAV7B;AAWH,6CAZmB,CAApB;;AAcA,iDAAKI,GAAL,GAAW,KAAK/B,GAAL,CAAS0B,SAAT,CAAmB,MAAnB,EACNvH,IADM,CACD,KAAKA,IADJ,EAEN6H,KAFM,GAEE/B,MAFF,CAES,GAFT,EAGNC,IAHM,CAGD,OAHC,EAGQ,MAHR,EAINA,IAJM,CAID,WAJC,EAIY,aAAK;AACpB,sEAAoB,OAAKnC,MAAL,CAAY0B,IAAhC,WAAyC,OAAKe,EAAL,CAAQtF,EAAEoB,KAAV,IAAmB,OAAKyB,MAAL,CAAY6B,GAAxE;AACH,6CANM,CAAX;;AAQA,iDAAKqC,IAAL,GAAY,KAAKF,GAAL,CAASL,SAAT,CAAmB,MAAnB,EACPvH,IADO,CACF,aAAK;AAAE,uDAAOe,EAAE4D,OAAT;AAAmB,6CADxB,EAEPkD,KAFO,EAAZ;;AAIA,iDAAKC,IAAL,CAAUhC,MAAV,CAAiB,MAAjB,EACKC,IADL,CACU,QADV,EACoB,KAAKQ,EAAL,CAAQU,SAAR,KAAoBnC,KADxC,EAEKiB,IAFL,CAEU,GAFV,EAEe,aAAK;AACZ,uDAAQ,OAAKzH,SAAL,KAAmB,WAApB,GAAmC,OAAKiI,EAAL,CAAQxF,EAAE8D,IAAV,CAAnC,GAAqD,OAAKwB,EAAL,CAAQtF,EAAEoB,KAAV,CAA5D;AACH,6CAJL,EAKK4D,IALL,CAKU,GALV,EAKe,aAAK;AACZ,uDAAQ,OAAKzH,SAAL,KAAmB,WAApB,GAAmC,CAAnC,GAAuC,OAAK0D,CAAL,CAAOjB,EAAE2D,QAAT,CAA9C;AACH,6CAPL,EAQKqB,IARL,CAQU,OARV,EAQmB,aAAK;AAAE,uDAAOhF,EAAE8D,IAAT;AAAe,6CARzC,EASKkB,IATL,CASU,OATV,EASmB,UAAChF,CAAD,EAAO;AAAE,uDAAO,OAAKiB,CAAL,CAAOjB,EAAEJ,KAAT,CAAP;AAAwB,6CATpD,EAUK6G,KAVL,CAUW,MAVX,EAUmB,aAAK;AAAE,uDAAO,OAAKxG,KAAL,CAAWD,EAAE8D,IAAb,CAAP;AAA2B,6CAVrD;;AAYA;AACJ,6CAAK,UAAL;AACI,iDAAKpG,WAAL,IAAoB,KAAK0F,OAAL,CAAatD,OAAb,CAAqB,aAAK;AAC1C,uDAAKgF,GAAL,CAASC,MAAT,CAAgB,MAAhB,EACKC,IADL,CACU,IADV,EACgB,CADhB,EAEKA,IAFL,CAEU,IAFV,EAEgB,OAAK9D,CAAL,CAAO,OAAKwC,OAAL,CAAa1D,CAAb,CAAP,CAFhB,EAGKgF,IAHL,CAGU,IAHV,EAGgB,CAAC,OAAKV,UAHtB,EAIKU,IAJL,CAIU,IAJV,EAIgB,OAAK9D,CAAL,CAAO,OAAKwC,OAAL,CAAa1D,CAAb,CAAP,CAJhB,EAKKgF,IALL,CAKU,OALV,EAKsBhF,CALtB,eAMKgF,IANL,CAMU,WANV,iBAMoC,OAAKnC,MAAL,CAAY0B,IANhD,UAMyD,OAAK1B,MAAL,CAAY6B,GANrE,QAOK+B,KAPL,CAOW,SAPX,EAOsB,MAPtB,EAQKA,KARL,CAQW,cARX,EAQ2B,CAR3B,EASKA,KATL,CASW,QATX,EASqB,OAAKxG,KAAL,CAAWD,CAAX,CATrB,EAUKyG,KAVL,CAUW,gBAVX,EAU6B,GAV7B;AAWH,6CAZmB,CAApB;;AAcA,iDAAKI,GAAL,GAAW,KAAK/B,GAAL,CAAS0B,SAAT,CAAmB,MAAnB,EACNvH,IADM,CACD,KAAKA,IADJ,EAEN6H,KAFM,GAEE/B,MAFF,CAES,GAFT,EAGNC,IAHM,CAGD,OAHC,EAGQ,MAHR,EAINA,IAJM,CAID,WAJC,EAIY,UAAChF,CAAD,EAAIS,CAAJ,EAAU;AACzB,sEAAoB,OAAKiF,EAAL,CAAQ1F,EAAEoB,KAAV,CAApB,WAAyC,CAAC,OAAKqD,WAAN,GAAoB,OAAK5B,MAAL,CAAY6B,GAAzE;AACH,6CANM,CAAX;;AAQA,iDAAKqC,IAAL,GAAY,KAAKF,GAAL,CAASL,SAAT,CAAmB,MAAnB,EACPvH,IADO,CACF,aAAK;AAAE,uDAAOe,EAAE4D,OAAF,CAAU9C,GAAV,CAAc,aAAK;AAAEP,sDAAEa,KAAF,GAAUpB,EAAEoB,KAAZ,CAAmB,OAAOb,CAAP;AAAU,iDAAlD,CAAP;AAA6D,6CADlE,EAEPuG,KAFO,EAAZ;;AAIA,iDAAKC,IAAL,CAAUhC,MAAV,CAAiB,MAAjB,EACKC,IADL,CACU,IADV,EACgB,UAAChF,CAAD,EAAIS,CAAJ,EAAU;AAAE,uDAAUT,EAAEoB,KAAZ,SAAqBX,CAArB;AAA0B,6CADtD,EAEKuE,IAFL,CAEU,QAFV,EAEoB,aAAK;AAAE,uDAAO,CAAC,OAAKP,WAAN,GAAoB,OAAKvD,CAAL,CAAOlB,EAAEJ,KAAT,CAA3B;AAA4C,6CAFvE,EAGKoF,IAHL,CAGU,GAHV,EAGe,aAAK;AACZ,uDAAQ,OAAKzH,SAAL,KAAmB,WAApB,GAAmC,OAAK2D,CAAL,CAAOlB,EAAEJ,KAAT,IAAkB,OAAK6E,WAA1D,GAA0E,OAAKvD,CAAL,CAAOlB,EAAEJ,KAAT,IAAkB,IAAG,CAAC,OAAK6E,WAA3B,GAA0C,OAAKvD,CAAL,CAAOlB,EAAE2D,QAAT,CAA3H;AACH,6CALL,EAMKqB,IANL,CAMU,GANV,EAMe,UAAChF,CAAD,EAAIS,CAAJ,EAAU;AACjB,uDAAQ,OAAKlD,SAAL,KAAmB,WAApB,GAAmC,OAAKoI,EAAL,CAAQ3F,EAAE8D,IAAV,IAAkB,OAAKjB,MAAL,CAAY0B,IAAjE,GAAwE,OAAKoB,EAAL,CAAQ3F,EAAE8D,IAAV,IAAkB,OAAK6B,EAAL,CAAQO,SAAR,KAAoBzF,CAAtC,GAA0C,OAAKoC,MAAL,CAAY0B,IAArI;AACH,6CARL,EASKS,IATL,CASU,OATV,EASmB,aAAK;AAAE,uDAAOhF,EAAE8D,IAAT;AAAe,6CATzC,EAUKkB,IAVL,CAUU,OAVV,EAUmB,KAAKW,EAAL,CAAQO,SAAR,KAAoBnC,KAVvC,EAWK0C,KAXL,CAWW,MAXX,EAWmB,aAAK;AAAE,uDAAO,OAAKxG,KAAL,CAAWD,EAAE8D,IAAb,CAAP;AAA2B,6CAXrD;;AAaA;AAjFR;;AAoFC,yCAAKvG,SAAL,KAAmB,WAApB,IAAoC,KAAKwJ,IAAL,CAAUhC,MAAV,CAAiB,MAAjB,EAC/BC,IAD+B,CAC1B,GAD0B,EACrB,aAAK;AACZ,+CAAQ,OAAKvH,WAAL,KAAqB,YAAtB,GACL,OAAKwD,CAAL,CAAOjB,EAAEJ,KAAT,IAAiB,CADZ,GAEL,OAAK+F,EAAL,CAAQ3F,EAAE8D,IAAV,IAAkB,OAAK6B,EAAL,CAAQO,SAAR,KAAoB,CAAtC,GAA0C,OAAKrD,MAAL,CAAY0B,IAFxD;AAGH,qCAL+B,EAM/BS,IAN+B,CAM1B,GAN0B,EAMrB,aAAK;AACZ,+CAAQ,OAAKvH,WAAL,KAAqB,YAAtB,GACL,OAAK+H,EAAL,CAAQxF,EAAE8D,IAAV,IAAkB,OAAK0B,EAAL,CAAQU,SAAR,KAAoB,CADjC,GAEL,OAAKhF,CAAL,CAAOlB,EAAEJ,KAAT,IAAkB,OAAK6E,WAAvB,GAAoC,CAFtC;AAGH,qCAV+B,EAW/BO,IAX+B,CAW1B,IAX0B,EAWpB,OAXoB,EAY/ByB,KAZ+B,CAYzB,MAZyB,OAYd,KAAKxD,YAAL,CAAkByD,MAAlB,CAAyBC,IAZX,EAa/BA,IAb+B,CAa1B,aAAK;AAAE,+CAAO3G,EAAEJ,KAAF,GAAUI,EAAEJ,KAAZ,GAAoB,EAA3B;AAAgC,qCAbb,CAApC;;AAeA,yCAAKiH,GAAL,CAASxH,EAAT,CAAY,WAAZ,EAAyB,aAAK;AAC1B,+CAAK2H,IAAL,CAAUP,KAAV,CAAgB,MAAhB,EAA2B,EAA3B;AACA,+CAAKO,IAAL,CAAUP,KAAV,CAAgB,KAAhB,EAA0B,EAA1B;AACA,+CAAKO,IAAL,CAAUP,KAAV,CAAgB,SAAhB,EAA2B,cAA3B;AACA,4CAAIQ,WAAW/J,GAAGsJ,SAAH,CAAa,QAAb,EAAuB,CAAvB,CAAf;AACA,4CAAIU,cAAcD,SAASA,SAAS9G,MAAT,GAAgB,CAAzB,EAA4BgH,QAA9C;AACA,+CAAKH,IAAL,CAAUnC,IAAV,CAAkB7E,EAAEoB,KAApB,WAA+B8F,YAAYpD,IAA3C,YAAsDoD,YAAYtH,KAAlE;AACA,4CAAI,OAAKlC,WAAT,EAAsB;AAClBR,+CAAGsJ,SAAH,OAAiBU,YAAYpD,IAA7B,EAAqC,CAArC,EAAwC,CAAxC,EAA2C2C,KAA3C,CAAiDW,OAAjD,GAA2D,EAA3D;AACH;AACJ,qCAVD;;AAYA,yCAAKP,GAAL,CAASxH,EAAT,CAAY,UAAZ,EAAwB,aAAK;AACzB,+CAAK2H,IAAL,CAAUP,KAAV,CAAgB,SAAhB,EAA2B,MAA3B;AACAvJ,2CAAGsJ,SAAH,CAAa,UAAb,EAAyB,CAAzB,EAA4B1G,OAA5B,CAAoC,aAAK;AACtCE,8CAAEyG,KAAF,CAAQW,OAAR,GAAkB,MAAlB;AACF,yCAFD;AAGH,qCALD;AAMH;AA7QsB;AAAA;AAAA,0DA+QbC,GA/Qa,EA+QR;AAAA;;AACX,wCAAI1J,aAAa,KAAKA,UAAtB;AACA,4CAAO0J,GAAP;AACI,6CAAK,UAAL;AACI,gDAAIC,iBAAkB,KAAK/J,SAAL,IAAkB,WAAlB,IAAiC,KAAKE,WAAL,IAAoB,YAAtD,GAAsE,KAAK2F,OAAL,CAAamE,KAAb,EAAtE,GAA4F,KAAKnE,OAAL,CAAamE,KAAb,GAAqBzF,OAArB,EAAjH;AACA,iDAAK1E,MAAL,GAAc,KAAK0H,GAAL,CAAS0B,SAAT,CAAmB,SAAnB,EACTvH,IADS,CACJqI,cADI,EAETR,KAFS,GAED/B,MAFC,CAEM,GAFN,EAGTC,IAHS,CAGJ,OAHI,EAGK,QAHL,EAITA,IAJS,CAIJ,WAJI,EAIS,UAAChF,CAAD,EAAIS,CAAJ,EAAU;AAAE,0EAAuBA,IAAE,EAAF,GAAO,OAAKoC,MAAL,CAAY6B,GAA1C;AAAmD,6CAJxE,CAAd;;AAMA,iDAAKtH,MAAL,CAAY2H,MAAZ,CAAmB,MAAnB,EACKC,IADL,CACU,GADV,EACe,KAAKV,UAAL,GAAgB,GAAhB,GAAsB,EADrC,EAEKU,IAFL,CAEU,OAFV,EAEmB,EAFnB,EAGKA,IAHL,CAGU,QAHV,EAGoB,EAHpB,EAIKyB,KAJL,CAIW,MAJX,EAImB,KAAKxG,KAJxB;;AAMA,iDAAK7C,MAAL,CAAY2H,MAAZ,CAAmB,MAAnB,EACKC,IADL,CACU,GADV,EACe,KAAKV,UAAL,GAAgB,GAAhB,GAAsB,EADrC,EAEKU,IAFL,CAEU,GAFV,EAEe,CAFf,EAGKA,IAHL,CAGU,IAHV,EAGgB,OAHhB,EAIKyB,KAJL,CAIW,aAJX,EAI0B,KAJ1B,EAKKA,KALL,CAKW,MALX,OAKsB,KAAKxD,YAAL,CAAkByD,MAAlB,CAAyBC,IAL/C,EAMKA,IANL,CAMU,aAAK;AAAE,uDAAO3G,CAAP;AAAW,6CAN5B;AAOA;AACJ,6CAAK,aAAL;AACI,iDAAK5C,MAAL,GAAc,KAAK0H,GAAL,CAAS0B,SAAT,CAAmB,SAAnB,EACTvH,IADS,CACJ,KAAKmE,OAAL,CAAamE,KAAb,EADI,EAETT,KAFS,GAED/B,MAFC,CAEM,GAFN,EAGTC,IAHS,CAGJ,OAHI,EAGK,QAHL,EAITA,IAJS,CAIJ,WAJI,EAIS,UAAChF,CAAD,EAAIS,CAAJ,EAAU;AAAE,uEAAoB,CAACA,CAAD,GAAG9C,UAAH,GAAgB,OAAK2G,UAAzC,WAAuD,CAAC,OAAKG,WAAN,GAAoB,EAApB,GAAyB,OAAK5B,MAAL,CAAY6B,GAA5F;AAAqG,6CAJ1H,CAAd;;AAMA,iDAAKtH,MAAL,CAAY2H,MAAZ,CAAmB,MAAnB,EACKC,IADL,CACU,GADV,EACe,UAAChF,CAAD,EAAIS,CAAJ,EAAU;AAAE,uDAAQA,IAAE9C,UAAF,GAAe,OAAKkF,MAAL,CAAY0B,IAA3B,GAAkC,OAAKD,UAAL,GAAgB,CAAlD,GAAqD,CAA7D;AAAiE,6CAD5F,EAEKU,IAFL,CAEU,OAFV,EAEmB,EAFnB,EAGKA,IAHL,CAGU,QAHV,EAGoB,EAHpB,EAIKyB,KAJL,CAIW,MAJX,EAImB,KAAKxG,KAJxB;;AAMA,iDAAK7C,MAAL,CAAY2H,MAAZ,CAAmB,MAAnB,EACKC,IADL,CACU,GADV,EACe,UAAChF,CAAD,EAAIS,CAAJ,EAAU;AAAE,uDAAQA,IAAE9C,UAAF,GAAe,OAAKkF,MAAL,CAAY0B,IAA3B,GAAkC,OAAKD,UAAL,GAAgB,CAAnD,GAAuD,CAA9D;AAAkE,6CAD7F,EAEKU,IAFL,CAEU,IAFV,EAEgB,EAFhB,EAGKA,IAHL,CAGU,IAHV,EAGgB,OAHhB,EAIKyB,KAJL,CAIW,aAJX,EAI0B,OAJ1B,EAKKA,KALL,CAKW,MALX,OAKsB,KAAKxD,YAAL,CAAkByD,MAAlB,CAAyBC,IAL/C,EAMKA,IANL,CAMU,aAAK;AAAE,uDAAO3G,CAAP;AAAW,6CAN5B;AAOA;AACJ;AACI;AA7CR;AA+CH;AAhUsB;AAAA;AAAA,8DAkUT;AACV,yCAAKgH,IAAL,GAAY9J,GAAG0H,MAAH,CAAU,KAAKzB,OAAf,EAAwB4B,MAAxB,CAA+B,KAA/B,EACPC,IADO,CACF,OADE,EACO,SADP,EAEPyB,KAFO,CAED,YAFC,EAEa,KAAKxD,YAAL,CAAkBuE,UAAlB,CAA6BC,SAF1C,EAGPhB,KAHO,CAGD,OAHC,EAGQ,KAAKxD,YAAL,CAAkByD,MAAlB,CAAyBgB,YAHjC,CAAZ;AAIH;AAvUsB;;AAAA;AAAA;;AA0U3B,iCAASC,QAAT,GAAoB;AAChB,gCAAG,CAACnF,KAAKvD,IAAT,EAAe;AACf,gCAAI2I,QAAQ,IAAIjF,eAAJ,CAAoB;AAC5B1D,sCAAMuD,KAAKvD,IADiB;AAE5B4D,wCAAQ,EAAC6B,KAAK,EAAN,EAAUH,MAAM,EAAhB,EAAoBI,QAAQ,EAA5B,EAAgCH,OAAO,EAAvC,EAFoB;AAG5B1B,yCAASN,KAAKC,YAHc;AAI5BU,yCAAS,QAJmB;AAK5BiB,uCAAO5B,KAAKrD,KAAL,CAAWiF,KALU;AAM5BC,wCAAQ7B,KAAKrD,KAAL,CAAWkF,MANS;AAO5BjH,wCAAQoF,KAAKrD,KAAL,CAAW/B,MAAX,CAAkBC,IAPE;AAQ5BC,0CAAUkF,KAAKrD,KAAL,CAAW/B,MAAX,CAAkBE,QARA;AAS5BC,2CAAWiF,KAAKrD,KAAL,CAAW5B,SATM;AAU5BE,6CAAa+E,KAAKrD,KAAL,CAAW1B,WAVI;AAW5BD,kDAAkBgF,KAAKrD,KAAL,CAAW3B,gBAXD;AAY5BG,4CAAY6E,KAAKrD,KAAL,CAAWxB,UAZK;AAa5BD,6CAAa8E,KAAKrD,KAAL,CAAWzB,WAbI;AAc5BuC,uCAAOuC,KAAKrD,KAAL,CAAWT;AAdU,6BAApB,CAAZ;;AAiBA8D,iCAAKrD,KAAL,CAAWV,QAAX,GAAsB,EAAtB;AACAmJ,kCAAMxE,OAAN,CAActD,OAAd,CAAsB,aAAK;AACvB0C,qCAAKrD,KAAL,CAAWV,QAAX,CAAoBsB,IAApB,CAAyB,EAAC4G,MAAM3G,CAAP,EAAUC,OAAO2H,MAAM3H,KAAN,CAAYD,CAAZ,CAAjB,EAAzB;AACH,6BAFD;AAGH;;AAED,6BAAKZ,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAW;AAChCsI;AACH,yBAFD;AAGH;;;;cA7boC5K,gB;;;;AAgczC8B,gCAAoBgJ,WAApB,GAAkC,sBAAlC","file":"ctrl.js","sourcesContent":["import {config} from '@grafana/runtime';\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport './css/groupedBarChart.css!';\nimport * as d3 from './external/d3.v3.min';\n\nconst panelDefaults = {\n    legend: {\n        show: true,\n        position: 'On graph',\n    },\n    chartType: 'stacked bar chart',\n    labelOrientation: 'horizontal',\n    orientation: 'vertical',\n    avgLineShow: true,\n    labelSpace: 40,\n    links: [],\n    datasource: null,\n    interval: null,\n    targets: [{}],\n    cacheTimeout: null,\n    nullPointMode: 'connected',\n    aliasColors: {},\n    format: 'short',\n    valueName: 'current',\n    sortType: 'stack-label',\n    sortDirection: 'ascending',\n    strokeWidth: 1,\n    fontSize: '80%',\n    colorSet: [],\n    colorSch: []\n};\n\nconst getCurrentTheme = () => config.theme;\n\nexport class GroupedBarChartCtrl extends MetricsPanelCtrl {\n\n    constructor($scope, $injector, $rootScope) {\n        super($scope, $injector);\n        this.data = null;\n\n        _.defaults(this.panel, panelDefaults);\n\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n        this.events.on('data-error', this.onDataError.bind(this));\n    }\n\n    onInitEditMode() {\n        this.addEditorTab('Options', 'public/plugins/grafana-groupedbarchart-panel/partials/editor.html', 2);\n        this.addEditorTab('Colors', 'public/plugins/grafana-groupedbarchart-panel/partials/colors.html', 3);\n    }\n\n    setUnitFormat(subItem) {\n        this.panel.format = subItem.value;\n        this.render();\n    }\n\n    onDataError() {\n        this.render();\n    }\n\n    updateColorSet() {\n        this.panel.colorSch = [];\n        this.panel.colorSet.forEach(d => this.panel.colorSch.push(d.color));\n        this.render();\n    }\n\n    onDataReceived(dataList) {\n        if (dataList && dataList.length) {\n            let o = _.groupBy(dataList[0].rows, e => e[0]);\n            _.forOwn(o, (e, i) => {\n                let t = _.groupBy(e, sta => sta[1]);\n                o[i] = _.forOwn(t, (sum, tid) => {t[tid] = sum.map(s => s[2]).reduce((x,y) => x+y)})\n            });\n\n            let res = [];\n            _.forOwn(o, (e, i) => {\n                e.label = i;\n                res.push(e);\n            });\n            if (this.panel.sortType === 'stack-label') {\n                this.data = res.sort((a, b) => {\n                    return (a.label > b.label) ? -1 : ((b.label > a.label) ? 1 : 0)\n                });\n            } else {\n                this.data = res.sort((a, b) => {\n                    let aSum = Object.values(a).reduce((prevVal, curVal) => {\n                        return typeof curVal == 'number' ? prevVal + curVal : prevVal;\n                    });\n                    let bSum = Object.values(b).reduce((prevVal, curVal) => {\n                        return typeof curVal == 'number' ? prevVal + curVal : prevVal;\n                    });\n\n                    return (aSum > bSum) ? -1 : ((bSum > aSum) ? 1 : 0);\n                });\n            }\n            if (this.panel.sortDirection === 'ascending') {\n                this.data.reverse();\n            }\n        } else {\n            this.data = [\n                {label:\"Machine001\", \"Off\":15, \"Down\":50, \"Run\": 0, \"Idle\":40},\n                {label:\"Machine002\", \"Off\":15, \"Down\":5, \"Run\":40, \"Idle\":15},\n                {label:\"Machine003\", \"Off\":15, \"Down\":30, \"Run\":40, \"Idle\":15},\n                {label:\"Machine004\", \"Off\":15, \"Down\":30, \"Run\":80, \"Idle\":15}\n            ];\n        }\n\n        this.render();\n    }\n\n    formatValue(value) {\n        let decimalInfo = this.getDecimalsForValue(value);\n        let formatFunc = kbn.valueFormats[this.panel.format];\n        if (formatFunc) {\n            return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n        }\n        return value;\n    }\n\n    link(scope, elem, attrs, ctrl) {\n        this.panelContent = elem.find('.panel-content');\n\n        class groupedBarChart {\n            constructor(opts) {\n                this.data = opts.data;\n                this.margin = opts.margin;\n                this.panelEl = opts.panelEl;\n                this.showLegend = opts.legend;\n                this.legendType = opts.position;\n                this.chartType = opts.chartType;\n                this.orientation = opts.orientation;\n                this.labelSpace = opts.labelSpace;\n                this.grafanaTheme = getCurrentTheme();\n                this.labelOrientation = opts.labelOrientation;\n                this.avgLineShow = opts.avgLineShow;\n                this.axesConfig = [];\n                this.element = elem.find(opts.element)[0];\n                this.options = [];\n                this.data.forEach(d => {\n                    this.options = this.options.concat(d3.keys(d));\n                });\n                this.options = _.uniq(this.options.filter(key => key !== 'label'));\n                this.avgList = {};\n                this.options.forEach(d => {this.avgList[d] = 0});\n                this.options = this.options.filter(d => d!=='valores');\n                this.data.forEach(d => {\n                    let stackVal = 0;\n                    d.valores = this.options.filter(k => k in d).map((name, i, o) => {\n                        if (i !== 0) stackVal = stackVal + (+d[o[i-1]]);\n                        this.avgList[name] = this.avgList[name] + d[name];\n                        return {name: name, value: +d[name], stackVal: stackVal};\n                    });\n                });\n                this.options.forEach(d => {\n                    this.avgList[d] /= this.data.length;\n                });\n                if (opts.color.length == 0) {\n                    this.color = d3.scale.ordinal()\n                        .range(d3.scale.category20().range());\n                } else {\n                    this.color = d3.scale.ordinal()\n                        .range(opts.color);\n                }\n\n                this.draw();\n            }\n\n            draw() {\n                const width = this.panelEl.width();\n                const height = this.panelEl.height();\n                this.graphwidth = width - this.margin.left - this.margin.right;\n                this.graphheight = height/1.2 - this.margin.top - this.margin.bottom;\n                d3.select(this.element).html(\"\");\n                this.svg = d3.select(this.element).append('svg');\n                this.svg.attr('width', width)\n                    .attr('height', height)\n                    .attr('transform', `translate(0, ${this.margin.top})`);\n\n                this.createScales();\n                this.addAxes();\n                this.addTooltips();\n                this.addBar();\n                if (this.showLegend) this.addLegend(this.legendType);\n            }\n\n            createScales() {\n                switch(this.orientation) {\n                    case 'horizontal':\n                        this.y0 = d3.scale.ordinal()\n                            .rangeRoundBands([+this.graphheight, 0], .2, 0.5);\n\n                        this.y1 = d3.scale.ordinal();\n\n                        this.x = d3.scale.linear()\n                            .range([0, +this.graphwidth]);\n                        this.axesConfig = [this.x, this.y0, this.y0, this.y1, this.x];\n                        break;\n                    case 'vertical':\n                        this.x0 = d3.scale.ordinal()\n                            .rangeRoundBands([0, +this.graphwidth], .2, 0.5);\n\n                        this.x1 = d3.scale.ordinal();\n\n                        this.y = d3.scale.linear()\n                            .range([0, +this.graphheight]);\n\n                        this.axesConfig = [this.x0, this.y, this.x0, this.x1, this.y];\n                        break;\n                }\n\n            }\n\n            addAxes() {\n                this.xAxis = d3.svg.axis()\n                    .scale(this.axesConfig[0])\n                    .tickSize(-this.graphheight)\n                    .orient('bottom');\n\n                this.yAxis = d3.svg.axis()\n                    .scale(this.axesConfig[1])\n                    .orient('left');\n\n                this.axesConfig[2].domain(this.data.map(d => { return d.label; }));\n                this.axesConfig[3].domain(this.options).rangeRoundBands([0, this.axesConfig[2].rangeBand()]);\n\n                let chartScale = (this.chartType === 'bar chart') ? 0 : 1;\n                let domainCal = (this.orientation === 'horizontal')\n                    ? [0, d3.max(this.data, function(d) { return d3.max(d.valores, d => { return (d.value + chartScale*d.stackVal); }); })]\n                    : [d3.max(this.data, function(d) { return d3.max(d.valores, d => { return (d.value + chartScale*d.stackVal); }); }), 0];\n                this.axesConfig[4].domain(domainCal);\n\n                let xAxisConfig = this.svg.append('g')\n                    .attr('class', 'x axis')\n                    .attr('transform', `translate(${this.margin.left}, ${this.graphheight + this.margin.top})`)\n                    .call(this.xAxis)\n                    .selectAll('text')\n                    .style('fill', `${this.grafanaTheme.colors.text}`);\n\n                xAxisConfig.selectAll('.tick line')\n                    .style('stroke', `${this.grafanaTheme.colors.text}`);\n\n                switch(this.labelOrientation) {\n                    case 'horizontal':\n                        break;\n                    case '45 degrees':\n                        xAxisConfig.style('text-anchor', 'end')\n                            .style('transform', 'rotate(-45deg)');\n                        break;\n                    case 'vertical':\n                        xAxisConfig.style('text-anchor', 'end')\n                            .style('transform', 'rotate(-90deg)');\n                        break;\n                }\n\n                let yAxisConfig = this.svg.append('g')\n                    .attr('class', 'y axis')\n                    .attr('transform', `translate(${this.margin.left}, ${this.margin.top})`)\n                    .style('fill', 'none')\n                    .call(this.yAxis);\n\n                yAxisConfig.selectAll('text')\n                    .style('fill', `${this.grafanaTheme.colors.text}`);\n                yAxisConfig.selectAll('path')\n                    .style('stroke', `${this.grafanaTheme.colors.text}`);\n                yAxisConfig.selectAll('.tick line')\n                    .style('stroke', `${this.grafanaTheme.colors.text}`);\n\n            }\n\n            addBar() {\n                let scale = (this.chartType === 'bar chart') ? 1 : this.options.length;\n                switch(this.orientation) {\n                    case 'horizontal':\n                        this.avgLineShow && this.options.forEach(d => {\n                            this.svg.append('line')\n                                .attr('x1', this.x(this.avgList[d]))\n                                .attr('y1', this.graphheight)\n                                .attr('x2', this.x(this.avgList[d]))\n                                .attr('y2', 0)\n                                .attr('class', `${d} avgLine`)\n                                .attr('transform', `translate(${this.margin.left}, ${this.margin.top})`)\n                                .style('display', 'none')\n                                .style('stroke-width', 2)\n                                .style('stroke', this.color(d))\n                                .style('stroke-opacity', 0.7);\n                        });\n\n                        this.bar = this.svg.selectAll('.bar')\n                            .data(this.data)\n                            .enter().append('g')\n                            .attr('class', 'rect')\n                            .attr('transform', d => {\n                                return `translate(${this.margin.left}, ${this.y0(d.label) + this.margin.top})`;\n                            });\n\n                        this.barC = this.bar.selectAll('rect')\n                            .data(d => { return d.valores; })\n                            .enter();\n\n                        this.barC.append('rect')\n                            .attr('height', this.y1.rangeBand()*scale)\n                            .attr('y', d => {\n                                return (this.chartType === 'bar chart') ? this.y1(d.name) : this.y0(d.label);\n                            })\n                            .attr('x', d => {\n                                return (this.chartType === 'bar chart') ? 0 : this.x(d.stackVal);\n                            })\n                            .attr('value', d => { return d.name;})\n                            .attr('width', (d) => { return this.x(d.value);})\n                            .style('fill', d => { return this.color(d.name);});\n\n                        break;\n                    case 'vertical':\n                        this.avgLineShow && this.options.forEach(d => {\n                            this.svg.append('line')\n                                .attr('x1', 0)\n                                .attr('y1', this.y(this.avgList[d]))\n                                .attr('x2', +this.graphwidth)\n                                .attr('y2', this.y(this.avgList[d]))\n                                .attr('class', `${d} avgLine`)\n                                .attr('transform', `translate(${this.margin.left}, ${this.margin.top})`)\n                                .style('display', 'none')\n                                .style('stroke-width', 2)\n                                .style('stroke', this.color(d))\n                                .style('stroke-opacity', 0.7)\n                        });\n\n                        this.bar = this.svg.selectAll('.bar')\n                            .data(this.data)\n                            .enter().append('g')\n                            .attr('class', 'rect')\n                            .attr('transform', (d, i) => {\n                                return `translate(${this.x0(d.label)}, ${+this.graphheight + this.margin.top})`;\n                            });\n\n                        this.barC = this.bar.selectAll('rect')\n                            .data(d => { return d.valores.map(e => { e.label = d.label; return e;}); })\n                            .enter();\n\n                        this.barC.append('rect')\n                            .attr('id', (d, i) => { return `${d.label}_${i}`;})\n                            .attr('height', d => { return +this.graphheight - this.y(d.value);})\n                            .attr('y', d => {\n                                return (this.chartType === 'bar chart') ? this.y(d.value) - this.graphheight :  (this.y(d.value) - 2*(+this.graphheight) + this.y(d.stackVal));\n                            })\n                            .attr('x', (d, i) => {\n                                return (this.chartType === 'bar chart') ? this.x1(d.name) + this.margin.left : this.x1(d.name) - this.x1.rangeBand()*i + this.margin.left;\n                            })\n                            .attr('value', d => { return d.name;})\n                            .attr('width', this.x1.rangeBand()*scale)\n                            .style('fill', d => { return this.color(d.name);});\n\n                        break;\n                }\n\n                (this.chartType === 'bar chart') && this.barC.append('text')\n                    .attr('x', d => {\n                        return (this.orientation === 'horizontal')\n                        ? this.x(d.value) +5\n                        : this.x1(d.name) + this.x1.rangeBand()/4 + this.margin.left;\n                    })\n                    .attr('y', d => {\n                        return (this.orientation === 'horizontal')\n                        ? this.y1(d.name) +(this.y1.rangeBand()/2)\n                        : this.y(d.value) - this.graphheight -8;\n                    })\n                    .attr('dy', '.35em')\n                    .style('fill', `${this.grafanaTheme.colors.text}`)\n                    .text(d => { return d.value ? d.value : ''; });\n\n                this.bar.on('mouseover', d => {\n                    this.tips.style('left', `${10}px`);\n                    this.tips.style('top', `${15}px`);\n                    this.tips.style('display', \"inline-block\");\n                    let elements = d3.selectAll(':hover')[0];\n                    let elementData = elements[elements.length-1].__data__;\n                    this.tips.html(`${d.label} , ${elementData.name} ,  ${elementData.value}`);\n                    if (this.avgLineShow) {\n                        d3.selectAll(`.${elementData.name}`)[0][0].style.display = '';\n                    }\n                });\n\n                this.bar.on('mouseout', d => {\n                    this.tips.style('display', \"none\");\n                    d3.selectAll('.avgLine')[0].forEach(d => {\n                       d.style.display = 'none';\n                    });\n                });\n            }\n\n            addLegend(loc) {\n                let labelSpace = this.labelSpace;\n                switch(loc) {\n                    case 'On graph':\n                        let defaultOptions = (this.chartType == 'bar chart' || this.orientation == 'horizontal') ? this.options.slice(): this.options.slice().reverse();\n                        this.legend = this.svg.selectAll('.legend')\n                            .data(defaultOptions)\n                            .enter().append('g')\n                            .attr('class', 'legend')\n                            .attr('transform', (d, i) => { return `translate(50,${i*20 + this.margin.top})`; });\n\n                        this.legend.append('rect')\n                            .attr('x', this.graphwidth*1.1 - 18)\n                            .attr('width', 18)\n                            .attr('height', 18)\n                            .style('fill', this.color);\n\n                        this.legend.append('text')\n                            .attr('x', this.graphwidth*1.1 - 24)\n                            .attr('y', 9)\n                            .attr('dy', '.35em')\n                            .style('text-anchor', 'end')\n                            .style('fill', `${this.grafanaTheme.colors.text}`)\n                            .text(d => { return d; });\n                        break;\n                    case 'Under graph':\n                        this.legend = this.svg.selectAll('.legend')\n                            .data(this.options.slice())\n                            .enter().append('g')\n                            .attr('class', 'legend')\n                            .attr('transform', (d, i) => { return `translate(${+i*labelSpace - this.graphwidth},${+this.graphheight + 24 + this.margin.top})`; });\n\n                        this.legend.append('rect')\n                            .attr('x', (d, i) => { return (i*labelSpace + this.margin.left + this.graphwidth*1 +0);})\n                            .attr('width', 18)\n                            .attr('height', 18)\n                            .style('fill', this.color);\n\n                        this.legend.append('text')\n                            .attr('x', (d, i) => { return (i*labelSpace + this.margin.left + this.graphwidth*1) +5; })\n                            .attr('dx', 18)\n                            .attr('dy', '1.1em')\n                            .style('text-anchor', 'start')\n                            .style('fill', `${this.grafanaTheme.colors.text}`)\n                            .text(d => { return d; });\n                        break;\n                    default:\n                        break;\n                }\n            }\n\n            addTooltips() {\n                this.tips = d3.select(this.element).append('div')\n                    .attr('class', 'toolTip')\n                    .style('background', this.grafanaTheme.background.scrollbar)\n                    .style('color', this.grafanaTheme.colors.textEmphasis);\n            }\n        }\n\n        function onRender() {\n            if(!ctrl.data) return;\n            var Chart = new groupedBarChart({\n                data: ctrl.data,\n                margin: {top: 10, left: 70, bottom: 10, right: 20},\n                panelEl: ctrl.panelContent,\n                element: '#chart',\n                width: ctrl.panel.width,\n                height: ctrl.panel.height,\n                legend: ctrl.panel.legend.show,\n                position: ctrl.panel.legend.position,\n                chartType: ctrl.panel.chartType,\n                orientation: ctrl.panel.orientation,\n                labelOrientation: ctrl.panel.labelOrientation,\n                labelSpace: ctrl.panel.labelSpace,\n                avgLineShow: ctrl.panel.avgLineShow,\n                color: ctrl.panel.colorSch\n            });\n\n            ctrl.panel.colorSet = [];\n            Chart.options.forEach(d => {\n                ctrl.panel.colorSet.push({text: d, color: Chart.color(d)});\n            });\n        }\n\n        this.events.on('render', function() {\n            onRender();\n        });\n    }\n}\n\nGroupedBarChartCtrl.templateUrl = 'partials/module.html';\n"]}